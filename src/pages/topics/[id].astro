---
import { getCollection, render } from 'astro:content';

import Layout from '../../layouts/Layout.astro';
import Prose from '../../components/Prose.astro';
import CriticalShiftList from '../../components/CriticalShiftList.astro';
import { getTopicData } from '../../model/model';

export async function getStaticPaths() {
  const topics = await getCollection('topics');

  return await Promise.all(topics.map(async (topic) => {
    return {
      params: { id: topic.id },
      props: {
        ...await getTopicData(topic),
      },
    };
  }));
}

const { 
  topic,
  criticalShifts,
} = Astro.props;

const { Content } = await render(topic);
---

<Layout title={topic.data.name}>
    <h1 class="text-3xl mt-12 mb-10 font-semibold">{topic.data.name}</h1>
    <Prose>
        <Content />
    </Prose>
    <h2 class="text-2xl font-semibold mt-12 mb-8">Co se musí stát?</h2>
    <CriticalShiftList criticalShifts={criticalShifts} />
</Layout>
